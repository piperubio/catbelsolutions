---
import { getLangFromUrl, useTranslations } from "../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<section id="contact" class="relative overflow-hidden">
  <div
    class="absolute inset-0 bg-gradient-to-br from-white via-[#F9FBFF] to-[#E8EEF6]"
  ></div>
  <div class="container relative mx-auto px-6 py-20 md:py-28">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
      <div class="space-y-6">
        <p class="text-primary font-semibold uppercase tracking-[0.5em]">
          {t('contact.sales')}
        </p>
        <h3
          class="text-4xl sm:text-5xl text-secondary font-semibold leading-tight"
        >
          {t('contact.title')}
        </h3>
        <p class="text-secondary/80 text-lg">{t('contact.description')}</p>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <a
            href="mailto:sales@catbel.solutions"
            class="bg-white rounded-2xl border border-secondary/10 p-5 flex flex-col gap-2 shadow-sm hover:shadow-lg transition-shadow"
          >
            <span class="text-xs uppercase text-secondary/60 tracking-wider"
              >{t('contact.email.label')}</span
            >
            <span class="text-lg font-semibold text-secondary break-words"
              >sales@catbel.solutions</span
            >
            <p class="text-xs text-secondary/70 leading-relaxed">
              {t('contact.email.desc')}
            </p>
          </a>
          <a
            href="https://wa.me/61404241062?text=Hello,%20I%20want%20more%20information%20about%20your%20products"
            target="_blank"
            rel="noopener"
            class="bg-secondary text-white rounded-2xl p-5 flex flex-col gap-2 shadow-lg hover:shadow-xl transition-shadow"
          >
            <span class="text-xs uppercase text-white/70 tracking-wider"
              >{t('contact.whatsapp.label')}</span
            >
            <span class="text-lg font-semibold text-white break-words"
              >+61 404 241 062</span
            >
            <p class="text-xs text-white/80 leading-relaxed">
              {t('contact.whatsapp.desc')}
            </p>
          </a>
        </div>

        <ul class="space-y-3 text-secondary/80 text-sm">
          <li class="flex gap-3">
            <span class="mt-1 h-2 w-2 rounded-full bg-primary"></span>
            <span>{t('contact.list.1')}</span>
          </li>
          <li class="flex gap-3">
            <span class="mt-1 h-2 w-2 rounded-full bg-primary"></span>
            <span>{t('contact.list.2')}</span>
          </li>
        </ul>
      </div>

      <div
        class="bg-white rounded-[32px] p-8 shadow-[0_25px_80px_-40px_rgba(15,32,39,0.5)] border border-secondary/5"
      >
        <form id="contact-form" class="flex flex-col gap-5" autocomplete="off">
          <div
            id="form-alert"
            class="hidden mb-4 p-4 rounded text-white font-bold text-center"
          ></div>

          <div class="flex flex-col gap-2">
            <label for="name" class="text-secondary font-semibold">
              {t('contact.form.name')}
            </label>
            <input
              type="text"
              id="name"
              name="name"
              required
              class="rounded-2xl border border-secondary/20 px-4 py-3 focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20"
              placeholder={t('contact.form.name.placeholder')}
            >
          </div>

          <div class="flex flex-col gap-2">
            <label for="email" class="text-secondary font-semibold">
              {t('contact.form.email')}
            </label>
            <input
              type="email"
              id="email"
              name="email"
              required
              class="rounded-2xl border border-secondary/20 px-4 py-3 focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20"
              placeholder={t('contact.form.email.placeholder')}
            >
          </div>

          <div class="flex flex-col gap-2">
            <label for="phone" class="text-secondary font-semibold">
              {t('contact.form.phone')}
            </label>
            <input
              type="tel"
              id="phone"
              name="phone"
              required
              class="rounded-2xl border border-secondary/20 px-4 py-3 focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20"
              placeholder={t('contact.form.phone.placeholder')}
            >
          </div>

          <div class="flex flex-col gap-2">
            <label for="message" class="text-secondary font-semibold">
              {t('contact.form.message')}
            </label>
            <textarea
              id="message"
              name="message"
              rows="4"
              required
              class="rounded-2xl border border-secondary/20 px-4 py-3 focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20"
              placeholder={t('contact.form.message.placeholder')}
            ></textarea>
          </div>

          <button
            type="submit"
            id="submit-btn"
            class="bg-primary hover:bg-orange-600 text-white font-semibold py-3 rounded-2xl shadow-lg transition-colors disabled:opacity-50"
          >
            {t('contact.form.submit')}
          </button>
        </form>
      </div>
    </div>
  </div>
</section>

<script>
  import { actions } from "astro:actions";

  const form = document.getElementById("contact-form") as HTMLFormElement;
  const alertBox = document.getElementById("form-alert");
  const submitBtn = document.getElementById("submit-btn") as HTMLButtonElement;

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();

    if (!(form && alertBox && submitBtn)) {
      return;
    }

    submitBtn.disabled = true;
    const originalBtnText = submitBtn.textContent;
    submitBtn.textContent = "SENDING...";
    alertBox.classList.add("hidden");

    const formData = new FormData(form);

    try {
      const { data, error } = await actions.sendContactEmail(formData);

      if (error) {
        throw new Error(
          error.message ||
            "Hemos tenido un problema. Por favor vuelve a intentarlo."
        );
      }

      alertBox.textContent = "Mensaje Enviado Correctamente";
      alertBox.classList.remove("hidden", "bg-red-500");
      alertBox.classList.add("bg-green-500");
      form.reset();
    } catch (error) {
      alertBox.textContent =
        error instanceof Error ? error.message : "An error occurred";
      alertBox.classList.remove("hidden", "bg-green-500");
      alertBox.classList.add("bg-red-500");
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = originalBtnText || "SUBMIT";
    }
  });
</script>
